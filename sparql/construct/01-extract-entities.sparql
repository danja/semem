PREFIX ragno: <http://purl.org/stuff/ragno/>
PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
PREFIX dcterms: <http://purl.org/dc/terms/>
PREFIX prov: <http://www.w3.org/ns/prov#>
PREFIX skos: <http://www.w3.org/2004/02/skos/core#>

# Extract all elements from the Semem knowledge base
# This creates a clean element-centric view with key properties
# Updated to work with actual data structure (ragno:Element + skos:Concept)
CONSTRUCT {
    ?element rdf:type ragno:Element ;
            rdf:type skos:Concept ;
            rdfs:label ?label ;
            skos:prefLabel ?prefLabel ;
            ragno:content ?content ;
            ragno:connectsTo ?connection ;
            ragno:hasEmbedding ?embedding ;
            ragno:weight ?weight ;
            ragno:centrality ?centrality ;
            ragno:confidence ?confidence ;
            dcterms:created ?created ;
            prov:wasDerivedFrom ?source ;
            ragno:sourceDocument ?sourceDoc ;
            ragno:inDomain ?domain .
}
WHERE {
    GRAPH ?g {
        ?element a ragno:Element .
        
        # Core element properties
        OPTIONAL { ?element rdfs:label ?label }
        OPTIONAL { ?element skos:prefLabel ?prefLabel }
        OPTIONAL { ?element ragno:content ?content }
        OPTIONAL { ?element ragno:connectsTo ?connection }
        OPTIONAL { ?element ragno:hasEmbedding ?embedding }
        OPTIONAL { ?element ragno:weight ?weight }
        OPTIONAL { ?element ragno:centrality ?centrality }
        OPTIONAL { ?element ragno:confidence ?confidence }
        OPTIONAL { ?element dcterms:created ?created }
        OPTIONAL { ?element prov:wasDerivedFrom ?source }
        
        # Trace to source document
        OPTIONAL {
            ?element prov:wasDerivedFrom+ ?sourceDoc .
            ?sourceDoc a ragno:Unit .
            FILTER(CONTAINS(STR(?sourceDoc), "doc-") || CONTAINS(STR(?sourceDoc), "document"))
        }
        
        # Infer domain from element content or source
        OPTIONAL {
            BIND(
                IF(CONTAINS(LCASE(COALESCE(?content, "")), "climate") || 
                   CONTAINS(LCASE(COALESCE(?content, "")), "ocean") ||
                   CONTAINS(LCASE(COALESCE(?content, "")), "warming"), 
                   "climate-science",
                   IF(CONTAINS(LCASE(COALESCE(?content, "")), "urban") || 
                      CONTAINS(LCASE(COALESCE(?content, "")), "city") ||
                      CONTAINS(LCASE(COALESCE(?content, "")), "planning"), 
                      "urban-planning",
                      IF(CONTAINS(LCASE(COALESCE(?content, "")), "neuron") || 
                         CONTAINS(LCASE(COALESCE(?content, "")), "brain") ||
                         CONTAINS(LCASE(COALESCE(?content, "")), "cognitive"), 
                         "neuroscience",
                         "general"))) AS ?domain
            )
        }
    }
}
ORDER BY DESC(?centrality) ?created