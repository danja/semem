PREFIX ragno: <http://purl.org/stuff/ragno/>
PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
PREFIX dcterms: <http://purl.org/dc/terms/>

# Extract all relationships from the knowledge base
# Creates a graph view focusing on entity-to-entity connections
CONSTRUCT {
    ?relationship rdf:type ragno:Relationship ;
                  ragno:hasSourceEntity ?sourceEntity ;
                  ragno:hasTargetEntity ?targetEntity ;
                  ragno:relationshipType ?relType ;
                  ragno:weight ?weight ;
                  ragno:description ?description ;
                  ragno:navigationScore ?navScore ;
                  ragno:conceptMatches ?conceptMatches ;
                  ragno:sourceCorpus ?sourceCorpus ;
                  dcterms:created ?created ;
                  ragno:confidence ?confidence .
    
    # Create simplified direct relationships for easier traversal
    ?sourceEntity ragno:relatedTo ?targetEntity ;
                  ragno:relationshipType ?relType ;
                  ragno:relationshipWeight ?weight .
}
WHERE {
    GRAPH <${graphURI}> {
        ?relationship a ragno:Relationship .
        
        # Core relationship properties
        ?relationship ragno:hasSourceEntity ?sourceEntity ;
                     ragno:hasTargetEntity ?targetEntity .
        
        OPTIONAL { ?relationship ragno:relationshipType ?relType }
        OPTIONAL { ?relationship ragno:weight ?weight }
        OPTIONAL { ?relationship ragno:description ?description }
        OPTIONAL { ?relationship ragno:navigationScore ?navScore }
        OPTIONAL { ?relationship ragno:conceptMatches ?conceptMatches }
        OPTIONAL { ?relationship ragno:sourceCorpus ?sourceCorpus }
        OPTIONAL { ?relationship dcterms:created ?created }
        OPTIONAL { ?relationship ragno:confidence ?confidence }
        
        # Filter out self-relationships
        FILTER(?sourceEntity != ?targetEntity)
    }
}
ORDER BY DESC(?weight) ?created