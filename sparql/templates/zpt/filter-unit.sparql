# ZPT FilterBuilder unit-level query
SELECT DISTINCT ?uri ?content ?entity ?unit ?embedding ?metadata
WHERE {
    GRAPH <{{graphName}}> {
        {
            ?uri a ragno:SemanticUnit ;
                 ragno:hasContent ?content .
            OPTIONAL { ?uri ragno:relatedTo ?entity }
            OPTIONAL { ?uri ragno:partOf ?unit }
            OPTIONAL { ?uri semem:embedding ?embedding }
            OPTIONAL { ?uri semem:metadata ?metadata }
        }
        UNION
        {
            ?uri a semem:Interaction .
            {
                ?uri semem:prompt ?content .
            } UNION {
                ?uri semem:output ?content .
            }
            OPTIONAL { ?uri semem:embedding ?embedding }
            OPTIONAL { ?uri semem:metadata ?metadata }
            BIND("memory" AS ?entity)
            BIND("interaction" AS ?unit)
        }
        {{filters}}
    }
}
{{orderBy}}
{{limit}}