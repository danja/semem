PREFIX ragno: <http://purl.org/stuff/ragno/>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
PREFIX dcterms: <http://purl.org/dc/terms/>
PREFIX prov: <http://www.w3.org/ns/prov#>
PREFIX skos: <http://www.w3.org/2004/02/skos/core#>
PREFIX semem: <http://purl.org/semem/>
PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>

# Updated query to work with actual Semem data structure (ragno:Element + skos:Concept)
SELECT DISTINCT 
    ?concept 
    ?conceptLabel 
    ?conceptContent 
    ?created
    ?hasEmbedding
    ?connectionTarget
    ?interactionId
    ?interactionPrompt
WHERE {
    GRAPH <${graphURI}> {
        # Find concept elements (ragno:Element + skos:Concept)
        ?concept a ragno:Element ;
                 a skos:Concept ;
                 skos:prefLabel ?conceptLabel ;
                 ragno:content ?conceptContent .
        
        # Check if it has an embedding
        OPTIONAL {
            ?concept ragno:hasEmbedding ?embedding .
            BIND(true as ?hasEmbedding)
        }
        
        # Find what this concept connects to (interactions)
        OPTIONAL {
            ?concept ragno:connectsTo ?connectionTarget .
            
            # If it connects to an interaction, get interaction details
            OPTIONAL {
                ?connectionTarget a semem:Interaction ;
                                 semem:id ?interactionId ;
                                 semem:prompt ?interactionPrompt .
            }
        }
        
        # Get creation timestamp (may not exist for concepts)
        OPTIONAL { ?concept dcterms:created ?created }
    }
}
ORDER BY ?created ?conceptLabel
${limit}